<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>動体視力トレーニング2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #f5f5f5;
    cursor: default;
  }

  /* 数字 */
  .number {
    position: absolute;
    font-weight: bold;
    white-space: nowrap;
  }

  /* レベル表示 */
  .level-display {
    position: absolute;
    top: 10px;
    font-size: 24px;
    font-weight: bold;
    background: rgba(255,255,255,0.7);
    padding: 5px 10px;
    border-radius: 8px;
    z-index: 10;
    cursor: pointer;
  }

  .digit-level { left: 10px; }   /* 左上 */
  .count-level { right: 10px; }  /* 右上 */
</style>
</head>
<body>

<div class="level-display digit-level" id="digitLevel">数字レベル 1</div>
<div class="level-display count-level" id="countLevel">表示レベル 1</div>

<script>
  const digitLevelEl = document.getElementById("digitLevel");
  const countLevelEl = document.getElementById("countLevel");

  const DIGIT_LEVELS = [1, 2, 3, 4, 5]; // 桁数レベル
  const COUNT_LEVELS = [1, 2, 3, 4, 5]; // 表示数レベル
  let currentDigitLevel = 0; // 初期桁数レベル1
  let currentCountLevel = 0; // 初期表示数レベル1

  const DISPLAY_TIME = 150; // 数字表示時間 0.15秒
  const NEXT_DELAY = 3000;  // 次の表示までの間隔 3秒

  // ランダムな数値を生成
  function getRandomNumber(digits) {
    const min = Math.pow(10, digits - 1);
    const max = Math.pow(10, digits) - 1;
    return digits === 1
      ? Math.floor(Math.random() * 10)
      : Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // 画面に合わせたフォントサイズを計算
  function getFontSize(digits) {
    const base = window.innerWidth * 0.8;  // 画面幅の8割を基準
    const sizePerChar = base / digits;
    return Math.min(sizePerChar, window.innerHeight * 0.2); // 高さ20%を上限
  }

  // 2つの矩形が重なるかどうか
  function isOverlap(a, b) {
    return !(a.x + a.w < b.x ||
             b.x + b.w < a.x ||
             a.y + a.h < b.y ||
             b.y + b.h < a.y);
  }

  function showNumbers() {
    const digits = DIGIT_LEVELS[currentDigitLevel];
    const count = COUNT_LEVELS[currentCountLevel];

    // 前回の数字を削除
    document.querySelectorAll(".number").forEach(el => el.remove());

    const placed = []; // 配置済みの矩形リスト
    const fontSize = getFontSize(digits);

    for (let i = 0; i < count; i++) {
      const numberEl = document.createElement("div");
      numberEl.className = "number";
      numberEl.textContent = getRandomNumber(digits);
      numberEl.style.fontSize = fontSize + "px";
      document.body.appendChild(numberEl);

      const numberWidth = numberEl.offsetWidth;
      const numberHeight = numberEl.offsetHeight;
      const maxX = window.innerWidth - numberWidth;
      const maxY = window.innerHeight - numberHeight;

      let x, y, rect, tries = 0;
      const MAX_TRIES = 100; // 無限ループ防止

      do {
        x = Math.random() * maxX;
        y = Math.random() * maxY;
        rect = { x, y, w: numberWidth, h: numberHeight };
        tries++;
      } while (placed.some(p => isOverlap(p, rect)) && tries < MAX_TRIES);

      numberEl.style.left = x + "px";
      numberEl.style.top = y + "px";

      placed.push(rect);

      setTimeout(() => {
        numberEl.remove();
      }, DISPLAY_TIME);
    }

    setTimeout(showNumbers, DISPLAY_TIME + NEXT_DELAY);
  }

  // 数字レベル切替（左上クリック）
  digitLevelEl.addEventListener("click", (event) => {
    event.stopPropagation();
    currentDigitLevel = (currentDigitLevel + 1) % DIGIT_LEVELS.length;
    digitLevelEl.textContent = `数字レベル ${currentDigitLevel + 1}`;
  });

  // 表示レベル切替（右上クリック）
  countLevelEl.addEventListener("click", (event) => {
    event.stopPropagation();
    currentCountLevel = (currentCountLevel + 1) % COUNT_LEVELS.length;
    countLevelEl.textContent = `表示レベル ${currentCountLevel + 1}`;
  });

  // 初期表示
  digitLevelEl.textContent = `数字レベル ${currentDigitLevel + 1}`;
  countLevelEl.textContent = `表示レベル ${currentCountLevel + 1}`;
  showNumbers();

  // ウィンドウサイズ変更時にリサイズ対応
  window.addEventListener("resize", () => {
    // 次回表示でサイズが更新される
  });
</script>

</body>
</html>
